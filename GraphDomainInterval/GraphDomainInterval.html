<!DOCTYPE html>
<html>
<head>
<meta name="keywords" content="Virtual Manipulative, OER, Open Educational Resource, WAMAP, MyOpenMath" />
<meta name="description" content="This applet is a Virtual Manipulative used define intervals" />
<meta name="author" content="David Lippman, Pierce College, Tacoma Washington" />
<meta name="author" content="William Meacham, Scottsdale Community College, Scottsdale, Arizona" />
<meta name="copyright" content="Copyright &copy 2014, GNU General Public License, version 2 (GPL-2.0)" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">

var xmidpoint;
var ymidpoint;
var xmin = -7;
var xmax = 6;
var xminep = 0;
var xmaxep = 1;
var hlocN = null;
var hlocS = null;
var vlocP = null;
var vlocQ = null;
var N = 11;
var S = 9;
var P = 9;
var Q = 11;
var lep = 2;
var rep = 2;
var tep = 2;
var bep = 2;
var border=20;
var tborder=20;
var snap = true;
var width = null;
var height = null;
var blue = "#0000FF";
var red = "#FF0000";
var black = "#000000";
var green = "#00FF00";
function redrawPic(isactive) {
	var canvas = $("#thecanvas");
	var w = canvas.attr("width") - 100;
	var h = canvas.attr("height") - 100;
	width = w;
	height = h;
	xmidpoint = w/2;
	ymidpoint = h/2;
	var ctx = canvas[0].getContext("2d");
	ctx.fillStyle = "#FFFFFF";
	ctx.fillRect(0,0,w,h);

	//spacing
	dx = (w-2*border)/(20);
	dy = (h-2*tborder)/(20);

	//draw grid
	ctx.beginPath();
	ctx.strokeStyle = black;
	ctx.lineWidth = .5;
	for (var i=0;i<21;i++) {
		ctx.moveTo(border+i*dx,tborder);
		ctx.lineTo(border+i*dx,h-20);
	}
	for (var i=0;i<21;i++) {
		ctx.moveTo(border,tborder+i*dy);
		ctx.lineTo(w-20,tborder+i*dy);
	}
	ctx.stroke();
	// Draw x and y axis
	ctx.beginPath();
	ctx.lineWidth=2;
	ctx.moveTo(border+10*dx,tborder);
	ctx.lineTo(border+10*dx,h-20);
	ctx.moveTo(border,tborder+10*dy);
	ctx.lineTo(w-20,tborder+10*dy);	
	ctx.stroke();
	
	// Draw scale
	ctx.fillStyle = blue;
	ctx.textAlign = 'center';
	ctx.textBaseline = 'top';
	ctx.font = '15px sans-serif';
	for (var i=0;i<21;i += 5) {
		ctx.fillText(scale*(i-10),border+i*dx,7+ymidpoint);
	}
	for (var i=0;i<21;i += 5) {
		ctx.fillText(-scale*(i-10),xmidpoint-7,border+i*dy-10);
	}
	
	if (hlocN==null) {
		hlocN = border+dx*N;
	}
	if (hlocS==null) {
		hlocS = border+dx*S;
	}
	if (vlocP==null) {
		vlocP = h - (tborder+dx*P);
	}
	if (vlocQ==null) {
		vlocQ = h - (tborder+dx*Q);
	}
	
	//draw right point
	endpoint(rep,0,hlocN,ctx);

	// draw left point
	endpoint(lep,1,hlocS,ctx);

	//draw top point
	vendpoint(tep,1,vlocQ,ctx);

	// draw bottom point
	vendpoint(bep,0,vlocP,ctx)	
	
	// Draw Horiz. line
	ctx.beginPath();
	ctx.lineWidth = 6;
	ctx.strokeStyle = blue;
	ctx.moveTo(hlocN-2,ymidpoint);
	ctx.lineTo(hlocS,ymidpoint);
	ctx.stroke();
	
	// Draw Vertical line
	ctx.beginPath();
	ctx.lineWidth = 6;
	ctx.strokeStyle = blue;
	ctx.moveTo(xmidpoint,vlocQ);
	ctx.lineTo(xmidpoint,vlocP);
	ctx.stroke();
	
	// draw graph
	ctx.beginPath();
	ctx.lineWidth = 2;
	ctx.strokeStyle = green;

	var xval = border+(xmin+10)*dx;
	var yval = height - (eval("2 * Math.pow(1.2,xmin)")+11)*dy;
	ctx.moveTo(xval,yval);
	for (var i = xmin+.1; i <= xmax;i+=.1) {
		xval = border+(i+10)*dx;
		yval = height - (eval("2 * Math.pow(1.2,i)")+11)*dy;
		ctx.lineTo(xval,yval);
	}
	ctx.stroke();

	
	// draw graph end points
	ctx.fillStyle = "#FFFFFF";
	xval = border+(xmin+10)*dx;
	yval = height - (eval("2 * Math.pow(1.2,xmin)")+11)*dy;
	ctx.moveTo(xval,yval);
	ctx.beginPath();
	if (xminep == 0) {
	  ctx.fillStyle = "#00FF00";
	}
	ctx.arc(xval,yval,5, 0, 2*Math.PI, false);
	ctx.fill();
	ctx.stroke();
	ctx.beginPath();
	ctx.fillStyle = "#FFFFFF";
	if (xmaxep == 0) {
	  ctx.fillStyle = "#00FF00";
	}	
	xval = border+(xmax+10)*dx;
	yval = height - (eval("2 * Math.pow(1.2,xmax)")+11)*dy;
	ctx.moveTo(xval,yval);
	ctx.beginPath();
	ctx.arc(xval,yval,5, 0, 2*Math.PI, false);
	ctx.fill();
	ctx.stroke();
	sendit();
}

function endpoint(type,direction,xloc,ctx) {
	ctx.beginPath();
	ctx.lineWidth = 3;
	ctx.strokeStyle = blue;
	if (type == 1) {
	  	if (direction == 0) {
			ctx.moveTo(xloc-10,ymidpoint+10);
			ctx.lineTo(xloc-1,ymidpoint);
			ctx.lineTo(xloc-10,ymidpoint-10);
		} else {
			ctx.moveTo(xloc+10,ymidpoint+10);
			ctx.lineTo(xloc+1,ymidpoint);
			ctx.lineTo(xloc+10,ymidpoint-10);
		}
	} else if (type == 3) {
		if (direction == 0) {
			ctx.moveTo(xloc-10,ymidpoint+10);
			ctx.lineTo(xloc-1,ymidpoint+10);
			ctx.lineTo(xloc-1,ymidpoint-10);
			ctx.lineTo(xloc-10,ymidpoint-10);
		} else {
			ctx.moveTo(xloc+10,ymidpoint+10);
			ctx.lineTo(xloc+1,ymidpoint+10);
			ctx.lineTo(xloc+1,ymidpoint-10);
			ctx.lineTo(xloc+10,ymidpoint-10);
		}
	} else if (type == 2) {
		if (direction == 0) {
			ctx.arc(xloc-16,ymidpoint,15, 1.7*Math.PI, .3*Math.PI, false);
		} else {
			ctx.arc(xloc+16,ymidpoint,15, .7*Math.PI, 1.3*Math.PI, false);

		}
	}
	ctx.stroke();
}

function vendpoint(type,direction,yloc,ctx) {
	ctx.beginPath();
	ctx.lineWidth = 3;
	ctx.strokeStyle = blue;
	if (type == 1) {
	  	if (direction == 0) {
			ctx.moveTo(xmidpoint+10,yloc-10);
			ctx.lineTo(xmidpoint,yloc-1);
			ctx.lineTo(xmidpoint-10,yloc-10);
		} else {
			ctx.moveTo(xmidpoint+10,yloc+10);
			ctx.lineTo(xmidpoint,yloc+1);
			ctx.lineTo(xmidpoint-10,yloc+10);
		}
	} else if (type == 3) {
		if (direction == 0) {
			ctx.moveTo(xmidpoint+10,yloc-10);
			ctx.lineTo(xmidpoint+10,yloc-1);
			ctx.lineTo(xmidpoint-10,yloc-1);
			ctx.lineTo(xmidpoint-10,yloc-10);
		} else {
			ctx.moveTo(xmidpoint+10,yloc+10);
			ctx.lineTo(xmidpoint+10,yloc+1);
			ctx.lineTo(xmidpoint-10,yloc+1);
			ctx.lineTo(xmidpoint-10,yloc+10);
		}
	} else if (type == 2) {
		if (direction == 0) {
			ctx.arc(xmidpoint,yloc-16,15, .2*Math.PI, .8*Math.PI, false);
		} else {
			ctx.arc(xmidpoint,yloc+16,15, 1.2*Math.PI, 1.8*Math.PI, false);

		}
	}
	ctx.stroke();
}



$(function() {redrawPic();});

var istouch = false;
function ontouchstart(evt) {
	if (!istouch) {
		$("#canvaswrapper").off("mousedown", onmousedown);
		$("#canvaswrapper").off("mousemove", onmousemove);
	}
	istouch = true;
	var touch = evt.originalEvent.changedTouches[0] || evt.originalEvent.touches[0];
	evt.pageX = touch.pageX;
	evt.pageY = touch.pageY;
	onmousedown(evt, $(this));
}

function ontouchmove(evt) {
	var touch = evt.originalEvent.changedTouches[0] || evt.originalEvent.touches[0];
	evt.pageX = touch.pageX;
	evt.pageY = touch.pageY;
	onmousemove(evt);
}


var mouseisdownN = false;
var mouseisdownS = false;

function onmousedown(e) {
	if (isInDragTargetN(e)) {
		 mouseisdownN = true;
	}
	if (isInDragTargetS(e)) {
	  	mouseisdownS = true;
	}
}
function onmouseup(e) {
	mouseisdownN = false;
	mouseisdownS = false;
	$("body").css("cursor","");
}
var isintargetN = false;
var isintargetS = false;
function onmousemove(e) {
	if (mouseisdownN) {
		var oldhlocN = hlocN;
		var xpos = e.offsetX === undefined ? e.originalEvent.layerX : e.offsetX;
		var bits = (xpos - border)/dx;
		var pixoff = (Math.abs(bits - Math.round(bits))*dx);
		if (xpos > hlocS && xpos < width - 20) {
			if (pixoff < 8) {
				var newN = Math.round(bits);
				if (newN > S) {
					N = newN;
					hlocN = border+dx*N;
					redrawPic(true);
				}
			} else if (!snap) {
				var newN = bits;
				if (newN > S) {
					N = newN;
					hlocN = border+dx*N;
					redrawPic(true);
				}
			}
		}
		e.preventDefault();
	} else if (mouseisdownS) {
		var xpos = e.offsetX === undefined ? e.originalEvent.layerX : e.offsetX;
		var bits = (xpos - border)/dx;
		var pixoff = (Math.abs(bits - Math.round(bits))*dx);
		if (xpos > border && xpos < hlocN) {
			if (pixoff < 8) {
				var newS = Math.round(bits);
				if (newS < N) {
					S = newS;
					hlocS = border+dx*S;
					redrawPic(true);
				}
			} else if (!snap) {
				var newS = bits;
				if (newS < N) {
					S = newS;
					hlocS = border+dx*S;
					redrawPic(true);
				}
			}
		}
		e.preventDefault();
	} else if (isInDragTargetN(e)) {
		if (!isintargetN) {
			$("body").css("cursor","ew-resize");
			isintargetN = true;
			redrawPic(true);
		}
	} else if (isInDragTargetS(e)) {
		if (!isintargetS) {
			$("body").css("cursor","ew-resize");
			isintargetS = true;
			redrawPic(true);
		}
	}else  {
		isintargetN = false;
		isintargetS = false;
		$("body").css("cursor","");
		redrawPic();
	}
}


function isInDragTargetN(e) {
	var xpos = e.offsetX === undefined ? e.originalEvent.layerX : e.offsetX;
	var ypos = e.offsetY === undefined ? e.originalEvent.layerY : e.offsetY;
	return (distsqr(xpos,ypos,hlocN,ymidpoint)<60);
}
function isInDragTargetS(e) {
	var xpos = e.offsetX === undefined ? e.originalEvent.layerX : e.offsetX;
	var ypos = e.offsetY === undefined ? e.originalEvent.layerY : e.offsetY;
	return (distsqr(xpos,ypos,hlocS,ymidpoint)<60);
}
function distsqr(x1,y1,x2,y2) {
	return ((x2-x1)*(x2-x1) + (y2-y1)*(y2-y1));
}

$(function() {
	$("#canvaswrapper").on("mousedown touchstart", onmousedown);
	$("body").on("mouseup touchend", onmouseup);
	$("#canvaswrapper").on("mousemove touchmove", onmousemove);
});

var scale=1;
function setScale(newscale){
   scale = newscale.value;
   redrawPic();
}

function setLeftEndPoint(newlep){
   lep = newlep.value;
   if (lep == 1) {
       	S = 0;
	hlocS = border+dx*S;
   }
   redrawPic();
}
function setRightEndPoint(newrep){
   rep = newrep.value;
   if (rep == 1) {
    	N = 20;
	hlocN = border+dx*N;
   }
   redrawPic();
}
function setTopEndPoint(newtep){
   tep = newtep.value;
   if (tep == 1) {
       	Q = 20;
	vlocQ =  height - (tborder+dy*Q)
   }
   redrawPic();
}
function setBottomEndPoint(newbep){
   bep = newbep.value;
   if (bep == 1) {
    	P = 0;
	vlocP = height - (tborder+dy*P);
   }
   redrawPic();
}

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

var qn;
$(function() {
 	qn = getParameterByName("qn");
 	if (qn != "") {	
 		var prevScale = getParameterByName("scale");
 		var prevlep = getParameterByName("lep");
 		var prevrep = getParameterByName("rep");
 		var prevN = getParameterByName("Nval");
 		var prevS = getParameterByName("Sval");
 		if (prevScale != "") {
			scale = Number(prevScale);
		}
 		if (prevN != "") {
			N = Number(prevN)/scale + 10;
		}
		if (prevS != "") {
			S = Number(prevS)/scale + 10;
		}

		if (prevlep != "") {
			lep = Number(prevlep);
		}
		if (prevrep != "") {
			rep = Number(prevrep);
		}
		hlocN = border+dx*N;
		hlocS = border+dx*S;
 		redrawPic();
 	}
})

function sendit(){
	var Nval = (N-10)*scale;
	var Sval = (S-10)*scale;
	var returnstring = qn + "::" + scale + "," + Sval + "," + Nval+ "," + lep + "," + rep;
	parent.postMessage(returnstring,"*");
}
</script>

<style type="text/css">
head, body, div {
	margin: 0; padding: 0;
}
body { 
	padding: 10px;
	font-family: san-serif;
	background-color: #fff;
}
</style>

</head>
<body>
<div id="canvaswrapper" style="position:relative;">
<canvas width="600" height="600" id="thecanvas" style="position:relative;">
Your browser does not support Canvas. Please use a modern browser.
</canvas>
<div id="control1" style="position:absolute;left:50px;top:520px;text-align:center;">
	Left End Point<br><select id="leftpoint" onchange="setLeftEndPoint(this)">
			<option value=1><</option>
			<option value=2  selected>(</option>
			<option value=3>[</option>
			<option value=4>None</option>
	      </select>
</div>
<div id="control2" style="position:absolute;left:280px;top:520px;text-align:center;">	      
	Scale<br> <select id="scale" onchange="setScale(this)">
			<option value=1 selected>1</option>
			<option value=2>2</option>
			<option value=5>5</option>
			<option value=10>10</option>
	      </select>
</div>	      
<div id="control3" style="position:absolute;left:450px;top:520px;text-align:center;">
	Right End Point<br> <select id="rightpoint" onchange="setRightEndPoint(this)">
			<option value=1 >></option>
			<option value=2  selected>)</option>
			<option value=3>]</option>
			<option value=4>None</option>
	      </select>
</div>
<div id="control4" style="position:absolute;left:550px;top:20px;text-align:center;">
	Top End Point<br><select id="toppoint" onchange="setTopEndPoint(this)">
			<option value=1>></option>
			<option value=2  selected>)</option>
			<option value=3>]</option>
			<option value=4>None</option>
	      </select>
</div>
<div id="control5" style="position:absolute;left:550px;top:300px;text-align:center;">
	Bottom End Point<br><select id="bottompoint" onchange="setBottomEndPoint(this)">
			<option value=1><</option>
			<option value=2  selected>(</option>
			<option value=3>[</option>
			<option value=4>None</option>
	      </select>
</div>

</div>
</body>
</html>
